%! TEX program = xelatex
\input{../../../../../../../tex/standalone-def.tex}
\import{}{pgfplots-def}
\input{tex/gmodel-common}

\pgfplotsset{%
  xmax=2999,
  ylabel={Counts / 15 keV},
  group/every plot/.append style={%
    xlabel={},
    restrict x to domain=500:3500,
  },
  spectrum/.append style={%
    ymin=2e-3, ymax=1e5,
  },
  legend style={%
    font=\footnotesize,
  },
}

\begin{document}
  \begin{tikzpicture}
    \begin{groupplot}

      \pgfplotstableread{data/originals/gerda_data_bkgmodel_phaseII_v07_01_orig_lar_M2_enrE1plusE2.csv}\loadedtable;

      \nextgroupplot[spectrum, ymode=log]

      \addlegendimage{data};
      \addlegendimage{model};
      \addlegendimage{only marks, mark=sigma bands}
      \addlegendimage{K42};
      \addlegendimage{U238};
      \addlegendimage{Co60};
      \addlegendimage{K40};
      \addlegendimage{Th228};
      \addlegendimage{Ac228};
      \addlegendimage{alphaBEGe};
      \addlegendimage{2nbbBEGe};

      \addlegendentry{Data};
      \addlegendentry{Model};
      \addlegendentry{1,2,3 $\sigma$};
      \addlegendentry{\kvz};
      \addlegendentry{\Pbh\ + \Bih};
      \addlegendentry{\Co};
      \addlegendentry{\kvn};
      \addlegendentry{\Bil\ + \Tl};
      \addlegendentry{\Ac};
      \addlegendentry{$\upalpha$ model};
      \addlegendentry{\nnbb};

      \addplot[data]  table {\loadedtable} \closedcycle;
      \addplot[Ac228] table {\loadedtable};
      \addplot[K42]   table {\loadedtable};
      \addplot[U238]  table {\loadedtable};
      \addplot[Co60]  table {\loadedtable};
      \addplot[K40]   table {\loadedtable};
      \addplot[Th228] table {\loadedtable};
      \addplot[model] table {\loadedtable};

      \node[anchor=north west] at (axis description cs:0.03,0.93) {\textsc{All} -- \gexpophasetwobkg};
      \node[anchor=north west] at (axis description cs:0.03,0.83) {\footnotesize two-detector events};

      \nextgroupplot[residuals]
      \addbrasilianplot

    \end{groupplot}
  \end{tikzpicture}
\end{document}
