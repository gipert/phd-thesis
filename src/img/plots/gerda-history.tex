%! TEX program = xelatex
\documentclass[tikz]{standalone}
\usepackage[lining]{ebgaramond}
\usepackage[math-style=ISO, bold-style=ISO]{unicode-math}
\setmathfont{Garamond-Math.otf}
\usepackage{pgfplots}
\usepgfplotslibrary{dateplot}
\usetikzlibrary{patterns}
\pgfplotsset{width=0.95\textwidth, height=7cm, scale only axis, compat=1.3}
\input{../../tex/paultolcolors}

\newcommand{\expPhI}{21.6}
\newcommand{\expNature}{10.8}
\newcommand{\expPRL}{12.4}
\newcommand{\expScience}{35.7}
\newcommand{\expFinal}{40}

\newcommand{\expCumPhI}{21.6}
\pgfmathsetmacro{\expCumNature}{\expPhI+\expNature}
\pgfmathsetmacro{\expCumPRL}{\expPhI+\expNature+\expPRL}
\pgfmathsetmacro{\expCumScience}{\expPhI+\expNature+\expPRL+\expScience}
\pgfmathsetmacro{\expCumFinal}{\expPhI+\expNature+\expPRL+\expScience+\expFinal}

\tikzstyle{expbars} = [
  pattern=north west lines,
  ybar interval,
]

\tikzstyle{phaseI} = [
  expbars,
  pattern color=TolVibBlue,
  draw=TolVibBlue
]

\tikzstyle{phaseII} = [
  expbars,
  pattern color=TolVibOrange,
  draw=TolVibOrange
]

\tikzstyle{phaseIIp} = [
  expbars,
  pattern color=TolVibRed,
  draw=TolVibRed
]

\tikzstyle{thalf} = [
  thick,
  mark options={fill=white},
  mark size=3pt
]

\tikzstyle{publabel} = [
  fill=white,
  rotate=0,
  anchor=east
]

\pgfplotsset{
  scale only axis,
  date coordinates in=x,
  xticklabel=\year-\month,
  xmin=2011-10-01, xmax=2020-02-01,
}

\begin{document}
  \begin{tikzpicture}
    \begin{axis}[
      axis y line*=right,
      axis x line=none,
      ylabel={exposure (kg$\cdot$yr)},
      ymin=0, ymax=130,
      grid=major
    ]
      % phase I
      \addplot[phaseI] coordinates {
        (2011-11-01, \expPhI)
        (2013-05-01, \expNature)
      }; \label{pI}
      % Nature
      \addplot[phaseII] coordinates {
        (2015-12-01, \expNature)
        (2016-06-01, \expPRL)
      };
      % PRL
      \addplot[phaseII] coordinates {
        (2016-06-01, \expPRL)
        (2017-04-01, \expScience)
      };
      % Science
      \addplot[phaseII] coordinates {
        (2017-04-01, \expScience)
        (2018-04-01, \expFinal)
      }; \label{pII}
      % ???
      \addplot[phaseIIp] coordinates {
        (2018-05-25, \expFinal)
        (2019-12-01, 0)
      }; \label{pIIp}
      \addplot[thick, draw=black, mark=none, dashed] coordinates {
        (2011-11-01, 0)              % start phI
        (2013-05-01, \expCumPhI)     % end phI
        (2015-12-01, \expCumPhI)     % start phII
        (2016-06-01, \expCumNature)  % Nature release
        (2017-04-01, \expCumPRL)     % PRL release
        (2018-04-01, \expCumScience) % Science release
        (2018-05-25, \expCumScience) % Start PhII+
        (2019-12-01, \expCumFinal)   % ???
      }; \label{expgain}
    \end{axis}

    \begin{axis}[
      axis y line*=left,
      ymin=0, ymax=13E25,
      % xticklabel style={rotate=45, anchor=east},
      xtick={2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01, 2016-01-01, 2017-01-01, 2018-01-01, 2019-01-01, 2020-01-01},
      xticklabels={2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020},
      % extra x ticks={2019-01-01},
      xlabel={}, %{Time},
      ylabel={$T^{0\upnu}_{1/2}$ lower limit (yr)},
      legend pos=north west,
      legend style={cells={anchor=west}, draw=none},
    ]
      \addlegendimage{/pgfplots/refstyle=pI, area legend}\addlegendentry{Phase I exposure}
      \addlegendimage{/pgfplots/refstyle=pII, area legend}\addlegendentry{Phase II exposure}
      \addlegendimage{/pgfplots/refstyle=pIIp, area legend}\addlegendentry{Phase II$^+$ exposure}
      \addlegendimage{/pgfplots/refstyle=expgain}\addlegendentry{exposure gain}
      % upper limits
      \addplot+[thalf, TolBriGreen] coordinates {
        (2013-05-01, 2.5E25)
        (2016-06-01, 5.3E25)
        (2017-04-01, 8.0E25)
        (2018-04-01, 9.0E25)
      }; \label{limits}
      \addlegendentry{lower limits}
      % sensitivities
      \addplot+[thalf, mark=triangle*, TolBriRed] coordinates {
        (2013-05-01, 2.4E25)
        (2016-06-01, 4.0E25)
        (2017-04-01, 5.8E25)
        (2018-04-01, 11E25)
      }; \label{sensitivities}
      \addlegendentry{sensitivity}

      \node[publabel] at (axis cs:2013-05-01, 0.3E26) {\sc PRL 111};
      \node[publabel] at (axis cs:2016-06-01, 0.6E26) {\sc Nature 544 47};
      \node[publabel] at (axis cs:2017-04-01, 0.85E26) {\sc PRL 120 132503};
      \node[publabel] at (axis cs:2018-04-01, 1.15E26) {\sc Science 365 1445};
    \end{axis}
  \end{tikzpicture}
\end{document}
